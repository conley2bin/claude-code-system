# 代码审查命令

对指定文件或最近的变更执行全面的代码审查，识别潜在问题并提出改进建议。

## 使用说明：

1. **确定审查范围：**
   - 如果未指定文件，审查最近未提交的变更（`git diff`）
   - 如果指定了文件，审查这些特定文件
   - 检查 `git status` 了解上下文

2. **审查维度：**

   **代码质量：**
   - 代码清晰度和可读性
   - 命名约定的一致性
   - 函数/方法长度和复杂度
   - 代码重复

   **架构与设计：**
   - 关注点分离
   - 单一职责原则
   - 抽象层次
   - 组件耦合度
   - 通用类中没有特殊情况逻辑

   **正确性与逻辑：**
   - 潜在的 bug 或边缘情况
   - 错误处理模式
   - Null/undefined 检查（应使用快速失败，而非防御式编程）
   - 逻辑流程的正确性

   **性能：**
   - 低效的算法或数据结构
   - 不必要的计算
   - 内存使用问题

   **测试与可维护性：**
   - 测试覆盖率缺口
   - 代码可维护性
   - 文档质量
   - 类型安全

3. **报告格式：**

   ```markdown
   ## 代码审查摘要

   **审查文件：** [文件列表]
   **总体评估：** [良好/需要改进/严重问题]

   ### 严重问题（必须修复）
   - [问题及位置和解释]

   ### 建议（应考虑）
   - [建议及理由]

   ### 优点
   - [做得好的地方]

   ### 详细分析
   [如需要，逐文件细分]
   ```

4. **重点关注领域（来自 CLAUDE.md）：**
   - **快速失败模式**：代码应立即失败，而非防御性检查
   - **无特殊情况**：使用多态而非类型检查
   - **单一真实来源**：无重复的状态/配置
   - **最小化代码**：删除不必要的实例变量和抽象
   - **向量化**：优先使用数组操作而非循环

## 审查示例：

### 示例 1：防御式编程反模式
```python
# ❌ 问题：防御性检查隐藏了 bug
if self.component and self.component.data:
    result = self.component.process()

# ✅ 建议：快速失败
if self.component is None:
    raise RuntimeError("component not initialized")
result = self.component.process()
```

### 示例 2：特殊情况逻辑反模式
```python
# ❌ 问题：通用代码中的类型检查
if isinstance(obj, SpecificType):
    special_handling(obj)

# ✅ 建议：使用多态
result = obj.process()  # 让每个类型实现自己的行为
```

## 重要提示：
- 提供建设性和具体的反馈
- 优先考虑严重问题而非次要的风格偏好
- 提供可操作的建议和代码示例
- 在适用时引用 CLAUDE.md 原则
- 考虑项目特定的架构模式
